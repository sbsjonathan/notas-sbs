<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Bíblia</title>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;500;700;800&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Sumana:wght@400;700&display=swap" rel="stylesheet">

  <!-- Swiper -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>

  <style>
    :root{
      --primary-color:#5B3C88;
      --accent-blue:#2d6bb3;
      --header-bg:#e4e3e8;
      --body-bg:#f0f2f5;
    }

    body{
      font-family: 'Noto Sans', sans-serif; /* Fonte padrão para UI */
      background-color:var(--body-bg);
      margin:0;
      padding:0;
      overscroll-behavior-x:none;
      -webkit-text-size-adjust:100%;
      text-size-adjust:100%;
    }

    /* Barra fixa no topo */
    .header{
      position:fixed; top:0; left:0; width:100%; z-index:10;
      display:flex; justify-content:center; align-items:center;
      padding:10px 15px; background-color:var(--header-bg);
      border-bottom:1px solid #dcdcdc; box-sizing:border-box;
    }
    .header .back-button{
      position:absolute; left:15px;
      color:var(--primary-color); text-decoration:none;
      font-size:1.1em; font-weight:500;
    }
    .header .title{ font-size:.95em; font-weight:700; }

    /* Área de slides */
    .swiper{ width:100%; height:100vh; }
    .swiper-slide{
      box-sizing:border-box;
      padding:60px 30px 50px 30px;
      overflow-y:auto;
      /* Permite seleção dentro do slide */
      -webkit-user-select:text;
      user-select:text;
      -webkit-touch-callout:default;
    }

    /* Título do livro (apenas no cap 1) */
    .book-title{
      font-family: 'Noto Sans', sans-serif; /* Mantém Noto Sans */
      font-size:1.5em; font-weight:800;
      margin-top:0; margin-bottom:10px; color:#333;
    }

    .chapter-start{ position: relative; }

    .chapter-number-large{
      position: absolute;
      left: 0;
      top: 0;
      font-family: 'Noto Sans', sans-serif; /* Mantém Noto Sans */
      font-size: 2rem;
      font-weight: 800;
      color: var(--accent-blue);
      line-height: 1;
      transform: translateY(-0.2em);
    }

    /* Estilo geral dos parágrafos */
    .verse-block{
      font-family: 'Sumana', serif;
      line-height: 1.6;
      font-size:1.1em;
      text-align:justify;
      text-indent:0;
      -webkit-user-select:text;
      user-select:text;
      -webkit-touch-callout:default;
    }

    /* Recuo só no primeiro versículo do parágrafo */
    .verse-block .verse-number:first-child { margin-left: 1.6em; }
    .verse-block.paragraph-indented .verse-number:first-child { margin-left: 1.5em; }
    .verse-block.paragraph-indented { margin-top: 0.25em; }

    /* Recuo no primeiro versículo do capítulo (sem número 1 visível) */
    .chapter-start .verse-block { text-indent: 1.6em; }
    
    .verse-number{
      font-family: 'Noto Sans', sans-serif; /* Mantém Noto Sans */
      display:inline-block;
      font-size:1em;
      font-weight:700;
      color:var(--accent-blue);
      line-height:1;
      vertical-align:middle;
      margin-right:.5em;
      transform:translateY(-0.15em);
    }
  </style>
</head>
<body>

  <div class="header">
    <a id="back-to-chapters-link" href="#" class="back-button">< Voltar</a>
    <span id="header-title" class="title"></span>
  </div>

  <div class="swiper">
    <div class="swiper-wrapper" id="bible-content-wrapper"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
  <script>
    const headerTitle = document.getElementById('header-title');
    const contentWrapper = document.getElementById('bible-content-wrapper');
    // A função renderChapterContent continua a mesma.
    function renderChapterContent(chapterData, bookName){ let finalHtml = ''; if (chapterData.capitulo === 1){ finalHtml += `<div class="book-title">${bookName.toUpperCase()}</div>`; } const firstVerse  = chapterData.versiculos[0]; finalHtml += `<div class="chapter-start"><span class="chapter-number-large">${chapterData.capitulo}</span><div class="verse-block">${firstVerse.texto}</div></div>`; const otherVerses = chapterData.versiculos.slice(1); let currentParagraphHTML = ''; let isFirstParagraphBlock = true;  otherVerses.forEach(verse => { if (verse.novo_paragrafo && currentParagraphHTML) { const divClass = isFirstParagraphBlock ? 'verse-block' : 'verse-block paragraph-indented'; finalHtml += `<div class="${divClass}">${currentParagraphHTML}</div>`; currentParagraphHTML = ''; isFirstParagraphBlock = false; } const verseSpan = `<span class="verse-number">${verse.verso}</span>${verse.texto}`; if (currentParagraphHTML !== '') { currentParagraphHTML += ' '; } currentParagraphHTML += verseSpan; }); if (currentParagraphHTML) { const divClass = isFirstParagraphBlock ? 'verse-block' : 'verse-block paragraph-indented'; finalHtml += `<div class="${divClass}">${currentParagraphHTML}</div>`; } return finalHtml; }

    async function loadBook(){
        try {
            const urlParams = new URLSearchParams(window.location.search);
            const bookFileName = urlParams.get('livro');
            const initialChapter = parseInt(urlParams.get('cap') || '1', 10);

            if (!bookFileName) {
                throw new Error('Livro não especificado na URL. Use ?livro=NOME&cap=X');
            }

            const response = await fetch(`livro/${bookFileName}/${bookFileName}.json`);
            if (!response.ok) throw new Error(`Não foi possível carregar o arquivo livro/${bookFileName}/${bookFileName}.json`);
            const bibleBook = await response.json();

            document.getElementById('back-to-chapters-link').href = `livro/${bookFileName}/${bookFileName}.html`;

            bibleBook.capitulos.forEach(chapter => {
                const slide = document.createElement('div');
                slide.className = 'swiper-slide';
                slide.setAttribute('data-chapter-number', chapter.capitulo);
                slide.innerHTML = renderChapterContent(chapter, bibleBook.nome_do_livro);
                contentWrapper.appendChild(slide);
            });

            new Swiper('.swiper', {
                initialSlide: initialChapter - 1,

                // <<< CONFIGURAÇÕES DO SWIPE MELHORADO ADICIONADAS AQUI >>>
                touchStartPreventDefault: false, // Permite que o usuário selecione texto
                noSwipingSelector: '.verse-block', // Impede o swipe sobre os blocos de texto
                threshold: 20, // Distância mínima para iniciar o swipe
                longSwipesRatio: 0.1, // Sensibilidade para swipes rápidos
                longSwipesMs: 200, // Duração de um swipe rápido

                on: {
                    init() {
                        headerTitle.textContent = `${bibleBook.nome_do_livro} ${initialChapter}`;
                    },
                    slideChange() {
                        const currentSlide = this.slides[this.activeIndex];
                        const newChapter = currentSlide.getAttribute('data-chapter-number');
                        headerTitle.textContent = `${bibleBook.nome_do_livro} ${newChapter}`;
                        const newUrl = `${window.location.pathname}?livro=${bookFileName}&cap=${newChapter}`;
                        history.pushState({path: newUrl}, '', newUrl);
                    }
                }
            });

        } catch (err) {
            console.error('Erro fatal:', err);
            contentWrapper.innerHTML = `<div class="swiper-slide" style="padding: 80px 30px;"><h2>Erro</h2><p>${err.message}</p></div>`;
        }
    }
    loadBook();
  </script>
</body>
</html>