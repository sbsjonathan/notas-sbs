<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rute - Capítulos</title>

  <!-- Estilo global da pasta 'livro' -->
  <link rel="stylesheet" href="../style-bbl.css">
  <!-- Navbar unificada -->
  <link rel="stylesheet" href="../../../navbar/navbar-unified.css">
</head>
<body>

  <div class="container">
    <!-- Cabeçalho -->
    <div class="header">
      <a href="../../biblia.html?resume=0" class="back-button">< Voltar</a>
      <span class="title">Rute</span>
    </div>

    <!-- Grade de Capítulos (1 a 4) -->
    <div class="chapters-grid">
      <a href="../../capitulo.html?livro=rute&cap=1" class="chapter-button">1</a>
      <a href="../../capitulo.html?livro=rute&cap=2" class="chapter-button">2</a>
      <a href="../../capitulo.html?livro=rute&cap=3" class="chapter-button">3</a>
      <a href="../../capitulo.html?livro=rute&cap=4" class="chapter-button">4</a>
    </div>
  </div>

  <!-- Navbar é carregada aqui -->
  <script src="../../../navbar/navbar-unified.js"></script>
  
  <!-- SCRIPT DE CORREÇÃO PARA A NAVEGAÇÃO -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const navbar = document.querySelector('.bottom-navbar');
      if (!navbar) return;

      // 1. Força a navbar a ficar sempre visível nesta página
      navbar.classList.remove('hidden');
      navbar.style.transform = 'transformY(0)';
      navbar.style.transition = 'none';

      // 2. Garante que o ícone "Bíblia" esteja ativo
      const activeItem = navbar.querySelector('[data-page="bible"]');
      if (activeItem) {
          navbar.querySelectorAll('.navbar-item').forEach(item => item.classList.remove('active'));
          activeItem.classList.add('active');
      }

      // 3. Helper para obter o parâmetro da semana (copiado de navbar-unified.js)
      function getSemanaParam() {
        if (window.semanaAtual) return `?semana=${window.semanaAtual}`;
        const urlParams = new URLSearchParams(window.location.search);
        const semanaURL = urlParams.get('semana');
        if (semanaURL) return `?semana=${semanaURL}`;
        
        const hoje = new Date();
        const diaDaSemana = hoje.getDay();
        const diasParaSegunda = diaDaSemana === 0 ? -6 : 1 - diaDaSemana;
        const segundaFeira = new Date(hoje);
        segundaFeira.setDate(hoje.getDate() + diasParaSegunda);
        const dia = String(segundaFeira.getDate()).padStart(2, '0');
        const mes = String(segundaFeira.getMonth() + 1).padStart(2, '0');
        return `?semana=${dia}-${mes}`;
      }

      // 4. Sobrescreve os links da navbar com os caminhos corretos para esta página
      const navLinks = {
        'home': '../../../index.html',
        'bible': '../../biblia.html?resume=0', // Adiciona ?resume=0 para evitar loop
        'notes': `../../../richtext/container.html${getSemanaParam()}`,
        'save': '../../../save/auth-supabase.html'
      };

      for (const [page, url] of Object.entries(navLinks)) {
        const item = navbar.querySelector(`.navbar-item[data-page="${page}"]`);
        if (item) {
          // Remove o onclick original e adiciona um que funciona
          item.setAttribute('onclick', ''); 
          item.addEventListener('click', (e) => {
            e.preventDefault();
            window.location.href = url;
          });
        }
      }
      
      // Lógica especial para A Sentinela
      const sentinelaItem = navbar.querySelector('.navbar-item[data-page="watchtower"]');
      if (sentinelaItem) {
        sentinelaItem.setAttribute('onclick', '');
        sentinelaItem.addEventListener('click', async (e) => {
          e.preventDefault();
          const semana = getSemanaParam().substring(8); // Extrai 'dd-mm'
          const basePath = '../../../';
          try {
            const response = await fetch(`${basePath}sentinela/${semana}.html`, { method: 'HEAD' });
            if (response.ok) {
              window.location.href = `${basePath}sentinela/${semana}.html`;
            } else {
              window.location.href = `${basePath}sentinela/em-breve.html?semana=${semana}`;
            }
          } catch (error) {
            window.location.href = `${basePath}sentinela/em-breve.html?semana=${semana}`;
          }
        });
      }
    });
  </script>

  <!-- Script para salvar/retomar posição da página (mantido igual) -->
  <script>
  (function () {
    const LAST_KEY = 'bbl:lastPage';
    const el = document.scrollingElement || document.documentElement;

    const book = (function(){
      const file = (location.pathname.split('/').pop() || '').toLowerCase();
      return file.replace(/\.html$/, '');
    })();

    const POS_KEY = 'bbl:pos:livro:' + book;
    const debounce = (fn,ms)=>{ let t; return ()=>{ clearTimeout(t); t=setTimeout(fn,ms); }; };

    function save(){
      try{
        localStorage.setItem(POS_KEY, String(el.scrollTop|0));
        localStorage.setItem(LAST_KEY, JSON.stringify({
          page:'livro',
          href: location.href,
          book,
          scrollTop: el.scrollTop|0,
          t: Date.now(),
          schema: 1
        }));
      }catch(e){}
    }

    document.addEventListener('DOMContentLoaded', ()=>{
      const y = parseInt(localStorage.getItem(POS_KEY)||'0',10);
      if (y) el.scrollTop = y;
      save();
    });

    window.addEventListener('scroll', debounce(save, 200), {passive:true});
    window.addEventListener('pagehide', save);
  })();
  </script>
</body>
</html>