<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>TXT4 — Montador de HTML Final</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <style>
/* Base */
html, body { height: 100%; margin: 0; padding: 0; font-family: system-ui, -apple-system, Arial, sans-serif; background: #f5f7fa; }
body { max-width: 100vw; padding: 0 3vw 6vw; box-sizing: border-box; }
h2 { margin: 16px 0 10px; font-size: 1rem; font-weight: 600; color: #2b3a55; }
p.descricao { font-size:.82em; color:#5a6472; margin: -5px 0 12px; }

/* Abas */
.tabs { position: sticky; top: 0; z-index: 5; display: flex; gap: 8px; padding: 10px 0; background: #f5f7fa; }
.tabs a { flex: 1; text-align: center; text-decoration: none; font-size: .9em; padding: .55em .7em; border-radius: 8px; background: #fff; color: #2b3a55; border: 1px solid #d6dae3; box-shadow: 0 1px 2.5px #0001; }
.tabs a.active { background: #3264b2; color: #fff; border-color: #3264b2; }

/* Ações e Botões */
.actions { display: flex; flex-wrap: wrap; gap: 8px; margin: 8px 0; }
.btn { font-size: .88em; padding: .55em .95em; border-radius: 9px; border: 1px solid transparent; box-shadow: 0 1px 2.5px #0001; min-height: 36px; cursor: pointer; transition: transform .06s, background .12s, border-color .12s; }
.btn:active { transform: translateY(1px); }
.btn-primary { background: #3264b2; color: #fff; }
.btn-secondary { background: #eef3ff; color: #274f8e; border-color: #c9d7fb; }
.btn-success { background: #23b94d; color: #fff; }

/* Áreas de texto */
textarea {
  width: 100%; font-size: 0.86em; border-radius: 9px; box-sizing: border-box;
  border: 1px solid #b8bac7; background: #fff; resize: vertical;
  margin: 8px 0 12px; line-height: 1.32; transition: border .13s;
  font-family: inherit; padding: 1em; white-space: pre-wrap;
}
textarea:focus { border-color: #3264b2; outline: none; }
#inputArea { min-height: 20vh; max-height: 40vh; }
#outputArea { min-height: 50vh; max-height: 80vh; }

@media (min-width: 900px) {
  body { max-width: 560px; margin: 32px auto; }
  .tabs a { flex: unset; }
  textarea { font-size: .92em; }
}
  </style>
</head>
<body>
  <nav class="tabs">
    <a href="txt1.html">TXT1</a>
    <a href="txt2.html">TXT2</a>
    <a href="txt3.html">TXT3</a>
    <a href="txt4.html" class="active">TXT4</a>
  </nav>

  <h2>Montador de HTML Final</h2>
  <p class="descricao">
    Combina o corpo do HTML (vindo do TXT3) com o cabeçalho e rodapé para criar o documento completo.
  </p>

  <textarea id="inputArea" placeholder="O conteúdo do TXT3 aparecerá aqui automaticamente."></textarea>

  <div class="actions">
    <button class="btn btn-primary" onclick="processar()">Processar e Montar</button>
    <button id="copyBtn" class="btn btn-secondary" onclick="copiar()">Copiar Resultado</button>
  </div>

  <textarea id="outputArea" readonly placeholder="O HTML final e completo aparecerá aqui..."></textarea>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      try {
        const semente = localStorage.getItem('TXT4_SEMENTE');
        if (semente) {
          document.getElementById('inputArea').value = semente;
          localStorage.removeItem('TXT4_SEMENTE');
          processar(); // Roda automaticamente se houver conteúdo
        }
      } catch (e) {}
    });

    function processar() {
      const corpoHtml = document.getElementById('inputArea').value;
      if (!corpoHtml.trim()) {
        alert('Área de entrada está vazia. Volte ao TXT3 e envie o conteúdo para cá.');
        document.getElementById('outputArea').value = '';
        return;
      }

      // **AQUI ESTÁ A MÁGICA**
      // 1. Define um valor padrão
      let numeroEstudo = 'XX'; 
      // 2. Procura pelo padrão "ESTUDO [número]" dentro da tag header
      const matchEstudo = corpoHtml.match(/<header class="barra-estudo">\s*<div>ESTUDO (\d+)<\/div>\s*<\/header>/);
      // 3. Se achar, atualiza a variável com o número encontrado
      if (matchEstudo && matchEstudo[1]) {
        numeroEstudo = matchEstudo[1];
      }

// O CABECALHO agora usa a variável `numeroEstudo` para montar o title e o data-estudo
const CABECALHO = `<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Estudo ${numeroEstudo}</title>

    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,wght@0,400;0,500;0,600;0,700;1,400&family=Noto+Sans:wght@400;700;800&family=Noto+Serif:ital@1&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="biblia/stylebbl.css">
    <link rel="stylesheet" href="clickable/clickable.css">
    <link rel="stylesheet" href="barra/barra.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/11.0.5/swiper-bundle.min.css">
    <link rel="stylesheet" href="imagem/swiper-zoom.css">

</head>
<body data-estudo="${numeroEstudo}">
<script>
  window.estudoId = document.body.dataset.estudo || '0';
<\/script>`;

// RODAPÉ LIMPO, SEM COMENTÁRIOS
const RODAPE = `
    <div id="modal-biblia">
        <div class="modal-biblia-content">
            <span id="modal-biblia-fechar">×</span>
            <div id="modal-biblia-corpo"></div>
        </div>
    </div>

    <script src="biblia/abrev.js"><\/script>
    <script src="biblia/scriptbbl.js"><\/script>
    <script src="clickable/cache.js"><\/script>
    <script src="clickable/agente_perguntas.js"><\/script>
    <script src="clickable/agente_recap.js"><\/script>
    <script src="clickable/clickable.js"><\/script>
    <script src="barra/barra.js"><\/script>
    <script src="mark.js"><\/script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/11.0.5/swiper-bundle.min.js"><\/script>
    <script src="imagem.js"><\/script>
    <script src="imagem/swiper-zoom.js"><\/script>

    <div id="zoom-container" class="zoom-container">
        <div class="zoom-header">
            <button class="zoom-btn-fechar" aria-label="Fechar">×</button>
        </div>
        <div class="zoom-content"></div>
        <div class="zoom-footer"></div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        new ZoomModal();
    });
    <\/script>
</body>
</html>`;

      const finalDoc = `${CABECALHO}\n\n${corpoHtml}\n${RODAPE}`;
      document.getElementById('outputArea').value = finalDoc;
      
      const btn = document.getElementById('copyBtn');
      btn.classList.remove('btn-success');
      btn.textContent = 'Copiar Resultado';
    }

    function copiar() {
      const output = document.getElementById('outputArea');
      if (!output.value.trim()) {
        alert('Nada para copiar. Clique em "Processar e Montar" primeiro.');
        return;
      }
      output.select();
      document.execCommand('copy');
      const btn = document.getElementById('copyBtn');
      btn.classList.add('btn-success');
      btn.textContent = 'Copiado!';
      setTimeout(() => {
        btn.classList.remove('btn-success');
        btn.textContent = 'Copiar Resultado';
      }, 1200);
    }
  </script>
</body>
</html>